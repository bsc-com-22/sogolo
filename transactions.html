<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Transactions - Sogolo</title>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #111827; background: #f8fafc; }
        a { color: inherit; text-decoration: none; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }

        /* Header */
        .header { position: sticky; top: 0; background: #fff; z-index: 100; border-bottom: 1px solid #eef2f7; }
        .header-inner { display: flex; align-items: center; justify-content: space-between; height: 72px; }
        .logo { display: inline-flex; align-items: center; gap: 10px; }
        .logo img { width: 82px; height: 82px; object-fit: contain; }
        .nav { display: flex; gap: 24px; align-items: center; }
        .nav a { color: #6b7280; font-weight: 500; }
        .nav a.active, .nav a:hover { color: #111827; }
        .actions { display: flex; gap: 12px; align-items: center; }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 10px 16px; border-radius: 10px; border: 1px solid #e5e7eb; background: #fff; color: #111827; cursor: pointer; font-weight: 600; }
        .btn-primary { background: #3b82f6; border-color: #3b82f6; color: #fff; }
        .btn-primary:hover { background: #2563eb; border-color: #2563eb; }
        .btn-secondary { background: #f9fafb; }
        .btn-icon { background: transparent; border: 1px solid #e5e7eb; padding: 8px 10px; border-radius: 8px; cursor: pointer; }

        /* Page heading */
        .page-header { padding: 28px 0 8px; }
        .page-title { font-size: 28px; font-weight: 700; margin: 0 0 6px; color: #0f172a; }
        .page-subtitle { color: #64748b; margin: 0 0 20px; }

        /* Layout */
        .main { padding: 16px 0 60px; }

        /* Transaction View Styles (aligned with component) */
        .transaction-view { display: grid; gap: 20px; }
        .transaction-header { display: flex; align-items: center; justify-content: space-between; }
        .transaction-header h3 { font-size: 20px; margin: 0; color: #0f172a; }

        .transaction-filters { display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center; }
        .filter-tabs { display: flex; gap: 8px; flex-wrap: wrap; }
        .filter-tab { border: 1px solid #e5e7eb; background: #fff; color: #374151; padding: 8px 12px; border-radius: 9999px; cursor: pointer; font-weight: 600; }
        .filter-tab.active { background: #111827; color: #fff; border-color: #111827; }
        .search-input { width: 260px; padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 10px; }

        .transaction-stats { display: grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap: 12px; }
        .stat-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; }
        .stat-value { font-size: 22px; font-weight: 800; color: #0f172a; }
        .stat-label { color: #6b7280; font-weight: 500; }

        .transaction-list { display: grid; gap: 10px; }
        .transaction-item { display: grid; grid-template-columns: 1fr auto auto; align-items: center; gap: 16px; padding: 14px; border: 1px solid #e5e7eb; background: #fff; border-radius: 12px; cursor: pointer; }
        .transaction-item:hover { border-color: #d1d5db; }
        .transaction-info { display: flex; gap: 16px; align-items: center; }
        .transaction-product h4 { margin: 0 0 4px; font-size: 16px; color: #0f172a; }
        .transaction-id { margin: 0; color: #9ca3af; font-size: 12px; }
        .transaction-parties { display: flex; gap: 16px; color: #6b7280; font-size: 14px; }
        .party-label { color: #9ca3af; margin-right: 4px; }
        .transaction-details { display: grid; gap: 6px; text-align: right; min-width: 200px; }
        .transaction-amount { font-weight: 800; color: #0f172a; }
        .transaction-status { font-size: 12px; font-weight: 700; padding: 6px 10px; border-radius: 9999px; justify-self: end; }
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-approved { background: #e0f2fe; color: #075985; }
        .status-completed { background: #dcfce7; color: #166534; }
        .status-cancelled { background: #fee2e2; color: #991b1b; }
        .status-disputed { background: #f3e8ff; color: #6b21a8; }
        .transaction-actions { display: flex; gap: 8px; }

        .loading-state, .empty-state, .error-state { text-align: center; padding: 28px; background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; }
        .empty-icon, .error-icon { font-size: 28px; margin-bottom: 8px; }

        .pagination { display: flex; gap: 8px; justify-content: center; margin-top: 8px; }
        .page-btn { border: 1px solid #e5e7eb; background: #fff; padding: 8px 12px; border-radius: 8px; cursor: pointer; }
        .page-btn.active { background: #111827; color: #fff; border-color: #111827; }
        .page-ellipsis { color: #9ca3af; align-self: center; }

        /* Modal */
        .modal { display: none; position: fixed; inset: 0; background: rgba(2,6,23,0.5); z-index: 200; padding: 20px; }
        .modal-content { background: #fff; max-width: 520px; margin: 40px auto; border-radius: 16px; overflow: hidden; border: 1px solid #e5e7eb; }
        .modal-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; border-bottom: 1px solid #eef2f7; }
        .modal-close { background: transparent; border: none; font-size: 22px; cursor: pointer; }
        .form-group { padding: 12px 20px; display: grid; gap: 6px; }
        .form-group label { font-size: 14px; color: #374151; font-weight: 600; }
        .form-control { padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 10px; }
        .form-text { color: #9ca3af; font-size: 12px; }
        .modal-actions { display: flex; gap: 10px; justify-content: flex-end; padding: 14px 20px 20px; }

        /* Footer */
        .footer { background: #111827; color: #e5e7eb; margin-top: 40px; }
        .footer-inner { padding: 24px 0; text-align: center; }
        .footer a { color: #93c5fd; }

        @media (max-width: 900px) {
            .transaction-details { min-width: 160px; }
            .transaction-parties { flex-direction: column; gap: 6px; }
            .transaction-stats { grid-template-columns: repeat(2, minmax(0,1fr)); }
        }
        @media (max-width: 640px) {
            .transaction-item { grid-template-columns: 1fr; align-items: start; }
            .transaction-details { text-align: left; justify-self: start; }
            .transaction-filters { grid-template-columns: 1fr; }
            .search-input { width: 100%; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container header-inner">
            <a href="index.html" class="logo"><img src="logo.png" alt="Sogolo" /></a>
            <nav class="nav">
                <a href="dashboard.html">Dashboard</a>
                <a class="active" href="transactions.html">Transactions</a>
                <a href="support.html">Support</a>
            </nav>
            <div class="actions">
                <a href="dashboard.html" class="btn btn-secondary">Back to Dashboard</a>
            </div>
        </div>
    </header>

    <section class="page-header">
        <div class="container">
            <h1 class="page-title">Transactions</h1>
            <p class="page-subtitle">View, filter, and manage your escrow transactions</p>
        </div>
    </section>

    <main class="main">
        <div class="container">
            <div id="transactionContainer"></div>
        </div>
    </main>

    <footer class="footer">
        <div class="container footer-inner">
            <div>&copy; <span id="currentYear"></span> Sogolo. All rights reserved.</div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/services/auth-service.js"></script>
    <script src="js/services/database-service.js"></script>
    <script src="js/services/transaction-service.js"></script>
    <script src="js/services/notification-service.js"></script>
    <script src="js/utils/helpers.js"></script>
    <script src="js/utils/validation.js"></script>
    <script src="js/utils/storage.js"></script>
    <script src="js/views/transaction-view.js"></script>
    <script src="js/app.js"></script>
    <script>
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        document.addEventListener('DOMContentLoaded', async () => {
            // Ensure Supabase is initialized
            if (!window.supabaseClient && typeof initializeSupabase === 'function') {
                initializeSupabase();
            }

            // Require authentication
            const tryRequire = async () => {
                if (window.sogoloApp && typeof window.sogoloApp.requireAuth === 'function') {
                    return await window.sogoloApp.requireAuth('signin.html');
                }
                // Fallback if app not ready yet
                if (window.authService) {
                    const res = await window.authService.getCurrentUser();
                    if (!res.success || !res.user) { window.location.href = 'signin.html'; return false; }
                    return true;
                }
                return false;
            };

            // Wait a tick for services
            let ok = await tryRequire();
            if (!ok) {
                await new Promise(r => setTimeout(r, 200));
                ok = await tryRequire();
            }
            if (!ok) return;

            // Mount the Transaction View
            new TransactionView('transactionContainer');
        });
    </script>
</body>
</html>
